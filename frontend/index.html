<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-SQL Agent</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- SheetJS for Excel support -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Text-to-SQL Agent</h1>
            <p class="subtitle">Chuy·ªÉn ƒë·ªïi c√¢u h·ªèi ti·∫øng Vi·ªát th√†nh SQL query</p>
        </header>

        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <!-- Query Mode Selector -->
                <div class="mode-selector">
                    <label class="mode-option">
                        <input type="radio" name="query-mode" value="simple" checked>
                        <span>üìù C√¢u h·ªèi ƒë∆°n gi·∫£n</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="query-mode" value="smart">
                        <span>üéØ Smart Query (File + Y√™u c·∫ßu)</span>
                    </label>
                </div>

                <!-- Simple Query Mode -->
                <div id="simple-mode" class="query-mode-content">
                    <label for="query-input">Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n:</label>
                    <textarea 
                        id="query-input" 
                        placeholder="V√≠ d·ª•: L·∫•y h·ªç t√™n kh√°ch h√†ng c√≥ s·ªë gi·∫•y t·ªù ƒë·ªãnh danh c√° nh√¢n = 001201015338"
                        rows="4"
                    ></textarea>
                </div>

                <!-- Smart Query Mode -->
                <div id="smart-mode" class="query-mode-content" style="display: none;">
                    <div class="smart-step">
                        <label class="step-label">üìÅ B∆∞·ªõc 1: Upload file danh s√°ch (Excel/CSV)</label>
                        <p class="step-desc">File ch·ª©a danh s√°ch CCCD, M√£ KH, ho·∫∑c b·∫•t k·ª≥ d·ªØ li·ªáu tra c·ª©u n√†o</p>
                        <input type="file" id="smart-file-input" accept=".csv,.xlsx,.xls" style="display: none;">
                        <button type="button" class="file-btn" onclick="document.getElementById('smart-file-input').click()">
                            Ch·ªçn file
                        </button>
                        <span id="smart-file-name" class="file-name"></span>
                        <button type="button" id="smart-clear-file" class="clear-file-btn" style="display: none;">‚úï</button>
                    </div>
                    
                    <div id="smart-file-preview" class="smart-file-preview" style="display: none;">
                        <p><strong>üìÑ File:</strong> <span id="smart-file-info-name"></span></p>
                        <p><strong>üìä S·ªë d√≤ng d·ªØ li·ªáu:</strong> <span id="smart-file-info-rows"></span></p>
                        <p>
                            <strong>üìå C·ªôt ch·ª©a m√£ tra c·ª©u:</strong>
                            <select id="smart-column-select" class="column-select"></select>
                        </p>
                        <div id="smart-data-preview" class="data-preview-mini"></div>
                    </div>

                    <div class="smart-step">
                        <label class="step-label">üí≠ B∆∞·ªõc 2: M√¥ t·∫£ y√™u c·∫ßu th√¥ng tin</label>
                        <p class="step-desc">Li·ªát k√™ c√°c th√¥ng tin b·∫°n c·∫ßn l·∫•y, th·ªùi ƒëi·ªÉm d·ªØ li·ªáu, ƒëi·ªÅu ki·ªán l·ªçc...</p>
                        <textarea 
                            id="smart-requirements" 
                            placeholder="V√≠ d·ª•:&#10;T√¥i c·∫ßn bi·∫øt th√¥ng tin kh√°ch h√†ng t·∫°i th·ªùi ƒëi·ªÉm T12/2025:&#10;- S·ªë CCCD&#10;- T√™n kh√°ch h√†ng&#10;- S·ªë t√†i kho·∫£n&#10;- Lo·∫°i t√†i kho·∫£n&#10;- Chi nh√°nh qu·∫£n l√Ω&#10;- Ng√†y m·ªü t√†i kho·∫£n"
                            rows="10"
                        ></textarea>
                    </div>

                    <div id="smart-preview" class="smart-preview" style="display: none;">
                        <h4>üîç Preview c√¢u query s·∫Ω g·ª≠i:</h4>
                        <pre id="smart-preview-text"></pre>
                    </div>
                </div>

                <!-- Options -->
                <div class="options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="execute-checkbox" checked>
                        <span>Th·ª±c thi query</span>
                    </label>
                </div>

                <button id="submit-btn" class="submit-btn">
                    <span class="btn-text">G·ª≠i c√¢u h·ªèi</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="spinner"></span> ƒêang x·ª≠ l√Ω...
                    </span>
                </button>
            </div>

            <!-- Result Section -->
            <div class="result-section" id="result-section" style="display: none;">
                <h2>K·∫øt qu·∫£</h2>
                
                <!-- SQL Query -->
                <div class="result-block">
                    <h3>üìù SQL Query</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyToClipboard('sql-query')">Copy</button>
                        <pre id="sql-query"></pre>
                    </div>
                </div>

                <!-- Execution Results -->
                <div class="result-block" id="execution-results" style="display: none;">
                    <h3>‚úÖ K·∫øt qu·∫£ th·ª±c thi</h3>
                    <div class="table-container" id="table-container"></div>
                </div>

                <!-- Error Display -->
                <div class="result-block error-block" id="error-block" style="display: none;">
                    <h3>‚ö†Ô∏è L·ªói</h3>
                    <pre id="error-message"></pre>
                </div>

                <!-- Metadata -->
                <div class="metadata" id="metadata">
                    <div class="metadata-item">
                        <span class="label">Th·ªùi gian:</span>
                        <span id="response-time">-</span>
                    </div>
                </div>
            </div>

            <!-- Examples Section -->
            <div class="examples-section">
                <h3>üí° V√≠ d·ª• c√¢u h·ªèi:</h3>
                <div class="example-cards">
                    <div class="example-card" onclick="fillExample(this)">
                        <p>L·∫•y h·ªç t√™n kh√°ch h√†ng c√≥ s·ªë gi·∫•y t·ªù ƒë·ªãnh danh c√° nh√¢n = 001201015338</p>
                    </div>
                    <div class="example-card" onclick="fillExample(this)">
                        <p>L·∫•y to√†n b·ªô d·ªØ li·ªáu b·∫£ng PRIM_PARTY</p>
                    </div>
                    <div class="example-card" onclick="fillExample(this)">
                        <p>ƒê·∫øm s·ªë l∆∞·ª£ng kh√°ch h√†ng trong h·ªá th·ªëng</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>API Status: <span id="api-status" class="status-checking">ƒêang ki·ªÉm tra...</span></p>
        </footer>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
